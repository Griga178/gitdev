
{% extends "base_page.html" %}
{% block content %}
<script type=text/javascript src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
  {% if get_flashed_messages() %}
    {{ get_flashed_messages()[0] }}
  {% endif %}

  <form action="" method="post">

    {{ form.csrf_token() }}

    {% for field in form if field.name != "csrf_token" %}
	<p>{{ field.label() }}</p>
	<p>{{ field }}
	    {% for error in field.errors %}
		{{ error }}
	    {% endfor %}
	</p>
    {% endfor %}

</form>

<form id="form" action="javascript:sendAjaxForm()" method="post">
  {{ form.csrf_token }}
  {{ form.name.label }} {{ form.name() }} {{ form.submit() }}
  <input type="submit" value="Отправить"/>
</form>

<div id="msg"></div>

<br><br><br><br>

  <form method="POST" id = 'tag_form'>
      {{ tags_form.csrf_token }}
       {{ tags_form.tag_name(size=10) }} {{ tags_form.attr_name(size=10) }} {{ tags_form.attr_val(size=10) }}
      <input type="submit" value="Go">
  </form>
  <script>
    $(document).ready(function () {
        $("#tag_form" ).submit(function( event ) {
          sendAjaxForm("tag_form", "msg");
          event.preventDefault();
        });
    });
  </script>

<br><br><br><br>
<script>
   // переопределить поведение кнопки "Отправить"
  $(document).ready(function () {
      $("#form" ).submit(function( event ) {
        sendAjaxForm("form", "msg");
        event.preventDefault();
      });
  });


 function sendAjaxForm(form_ajax, msg) {
     var form = $("#" + form_ajax);
     $.ajax({
         type: form.attr('method'),
         url: '/settings',
         data: form.serialize(),
         success: function (response) {
            alert(response)
            var json = $.parseJSON(response);

            $('#' + msg).html(json.msg);
            if (json.success == 'true') {
               form.trigger('reset');
             }
             else
             {
                 alert("Что-то пошло не так!");
                 console.log("Ошибка");
             }
         },
         error: function (error) {
           console.log(error);
         }
     });
 }
</script>

  <p>Формы:<br>
  Добавить предмет:<br>
  Добавить модель:<br>
  соединить прeдмет с моделью:<br>
  соед. модель с предметом:<br>
  добавить характеристику в модель:<br>
  добавить хар-ку в предмет:<br>
  </p>
  <p>ЦМЕЦ:</p><br>
  <p>поиск конрактов, <br>
      по предметам (название, цена +/-)<br>
    связывание предмета контракта с предметом (либо моделью)<br>

  </p>
</div>

{% endblock %}
