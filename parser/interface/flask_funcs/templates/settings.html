{% extends "base_page.html" %}
{% block content %}

  {% if get_flashed_messages() %}
    {{ get_flashed_messages()[0] }}
  {% endif %}
  <form action="" method="post">

    {{ form.csrf_token() }}

    {% for field in form if field.name != "csrf_token" %}
	<p>{{ field.label() }}</p>
	<p>{{ field }}
	    {% for error in field.errors %}
		{{ error }}
	    {% endfor %}
	</p>
    {% endfor %}

</form>
<form id="form1" action="/settings" method="post">
  {{ form.csrf_token }}
  {{ form.name.label }} {{ form.name() }}
  <input type="submit" value="Отправить"/>
</form>
<div id="msg"></div>
<script>
  /* переопределить поведение кнопки "Отправить" */
  $(document).ready(function () {
      $("#form1" ).submit(function( event ) {
        sendAjaxForm("form1", "msg");
        event.preventDefault();
      });
  });

   /* отправка формы через ajax */
 function sendAjaxForm(form_ajax, msg) {
     var form = $("#" + form_ajax);
     $.ajax({
         type: form.attr('method'),
         url: form.attr('action'),
         data: form.serialize(),
         success: function (response) {
             var json = jQuery.parseJSON(response);
             $('#' + msg).html(json.msg);
             if (json.success == 'true') {
                 form.trigger('reset');
             }
             else
             {
                 alert("Что-то пошло не так!");
                 console.log("Ошибка");
             }
         },
         error: function (error) {
             console.log(error);
         }
     });
 }
</script>

  <p>Формы:<br>
  Добавить предмет:<br>
  Добавить модель:<br>
  соединить прдмет с моделью:<br>
  соед. модель с предметом:<br>
  добавить характеристику в модель:<br>
  добавить хар-ку в предмет:<br>
  </p>
  <p>ЦМЕЦ:</p><br>
  <p>поиск конрактов, <br>
      по предметам (название, цена +/-)<br>
    связывание предмета контракта с предметом (либо моделью)<br>

  </p>
</div>

{% endblock %}
